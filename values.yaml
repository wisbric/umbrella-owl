# =============================================================================
# umbrella-owl — Base values
# =============================================================================
# Each top-level key corresponds to a subchart name. Values under that key are
# passed directly to the subchart. See each subchart's values.yaml for the full
# list of options.
# =============================================================================

# -----------------------------------------------------------------------------
# GHCR registry credentials — shared imagePullSecret for all owl sub-charts
# The password should be a GitHub PAT with read:packages scope.
# For lab: set username/password via values.lab-secrets.yaml
# For production: inject via external-secrets-operator or --set
# -----------------------------------------------------------------------------
registryCredentials:
  create: false
  secretName: ghcr-credentials
  registry: ghcr.io
  username: ""
  password: ""

# -----------------------------------------------------------------------------
# NightOwl — Incident management, on-call, alert routing
# Chart: oci://ghcr.io/wisbric/charts/nightowl
# Source values: nightowl/deploy/helm/nightowl/values.yaml
# -----------------------------------------------------------------------------
nightowl:
  imagePullSecrets:
    - name: ghcr-credentials

  replicaCount:
    api: 2
    worker: 1

  image:
    repository: ghcr.io/wisbric/nightowl
    pullPolicy: IfNotPresent
    tag: ""

  frontend:
    enabled: true
    image:
      repository: ghcr.io/wisbric/nightowl-web
      pullPolicy: IfNotPresent
      tag: ""
    replicas: 2
    service:
      type: ClusterIP
      port: 80
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi

  api:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  worker:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi

  config:
    logLevel: info
    logFormat: json
    corsAllowedOrigins: ""
    metricsPath: /metrics

  secrets:
    create: true
    existingSecret: ""
    databaseUrl: ""
    redisUrl: ""
    oidcIssuerUrl: ""
    oidcClientId: ""
    oidcClientSecret: ""
    sessionSecret: ""
    slackBotToken: ""
    slackSigningSecret: ""
    slackAlertChannel: ""

  service:
    type: ClusterIP
    port: 80
    targetPort: 8080

  ingress:
    enabled: false
    className: nginx
    annotations: {}
    hosts:
      - host: nightowl.example.com
        paths:
          - path: /
            pathType: Prefix
    tls: []

  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

# -----------------------------------------------------------------------------
# BookOwl — Knowledge management, runbooks, collaborative editor
# Chart: oci://ghcr.io/wisbric/charts/bookowl
# Source values: bookowl/deploy/helm/bookowl/values.yaml
# -----------------------------------------------------------------------------
bookowl:
  image:
    repository: ghcr.io/wisbric/bookowl
    pullPolicy: IfNotPresent
    tag: ""

  web:
    image:
      repository: ghcr.io/wisbric/bookowl-web
      pullPolicy: IfNotPresent
      tag: ""
    replicas: 2
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi

  api:
    replicas: 2
    port: 8081
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  collab:
    enabled: true
    image:
      repository: ghcr.io/wisbric/bookowl-collab
      tag: ""
    replicas: 2
    port: 1234
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi
    wsUrl: ""
    ingress:
      enabled: false
      host: collab.bookowl.example.com

  secretKey: ""

  database:
    url: ""

  redis:
    url: ""
    host: ""
    port: "6379"
    password: ""

  oidc:
    issuerUrl: ""
    clientId: bookowl

  nightowl:
    apiUrl: ""
    apiKey: ""

  ingress:
    enabled: false
    className: nginx
    annotations: {}
    hosts:
      - host: bookowl.example.com
        paths:
          - path: /
            pathType: Prefix
            service: web
          - path: /api
            pathType: Prefix
            service: api
    tls: []

  metrics:
    enabled: false
    serviceMonitor:
      enabled: false
      interval: 30s

  pdb:
    enabled: true
    minAvailable: 1

  serviceAccount:
    create: true
    name: ""

  imagePullSecrets:
    - name: ghcr-credentials
  extraEnv: []

# -----------------------------------------------------------------------------
# TicketOwl — Ticket management portal over Zammad
# Chart: oci://ghcr.io/wisbric/charts/ticketowl
# Source values: ticketowl/charts/ticketowl/values.yaml
# -----------------------------------------------------------------------------
ticketowl:
  imagePullSecrets:
    - name: ghcr-credentials

  image:
    repository: ghcr.io/wisbric/ticketowl
    pullPolicy: IfNotPresent
    tag: ""

  api:
    replicaCount: 2
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi
    autoscaling:
      enabled: false
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 80

  worker:
    replicaCount: 1
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi

  config:
    logLevel: info
    logFormat: json
    port: "8082"
    workerPollSeconds: "60"
    nightowlApiUrl: ""
    bookowlApiUrl: ""
    otelEndpoint: ""

  secrets:
    create: true
    existingSecret: ""
    dbUrl: ""
    redisUrl: ""
    oidcIssuer: ""
    oidcClientId: ""
    encryptionKey: ""
    nightowlApiKey: ""
    bookowlApiKey: ""

  service:
    type: ClusterIP
    port: 8082

  ingress:
    enabled: false
    className: nginx
    annotations: {}
    hosts:
      - host: ticketowl.example.com
        paths:
          - path: /
            pathType: Prefix
    tls: []

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  migration:
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi

# -----------------------------------------------------------------------------
# PostgreSQL (Bitnami) — Shared database
# Chart: oci://registry-1.docker.io/bitnamicharts/postgresql
# Set enabled: false to use an external PostgreSQL instance instead
# -----------------------------------------------------------------------------
postgresql:
  enabled: true
  auth:
    postgresPassword: ""       # MUST override — no default
    database: nightowl
  primary:
    persistence:
      size: 20Gi
    resources:
      requests:
        cpu: 250m
        memory: 256Mi
      limits:
        cpu: "1"
        memory: 1Gi
    initdb:
      scripts:
        # Create databases and users for each owl app
        create-databases.sql: |
          CREATE DATABASE bookowl;
          CREATE DATABASE ticketowl;
          CREATE USER nightowl WITH PASSWORD 'changeme';
          CREATE USER bookowl WITH PASSWORD 'changeme';
          CREATE USER ticketowl WITH PASSWORD 'changeme';
          GRANT ALL PRIVILEGES ON DATABASE nightowl TO nightowl;
          GRANT ALL PRIVILEGES ON DATABASE bookowl TO bookowl;
          GRANT ALL PRIVILEGES ON DATABASE ticketowl TO ticketowl;

# -----------------------------------------------------------------------------
# Redis (Bitnami) — Shared cache, sessions, event queues
# Chart: oci://registry-1.docker.io/bitnamicharts/redis
# Set enabled: false to use an external Redis instance instead
# -----------------------------------------------------------------------------
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
  master:
    persistence:
      size: 2Gi
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi

# -----------------------------------------------------------------------------
# Keycloak (Bitnami) — OIDC identity provider
# Chart: oci://registry-1.docker.io/bitnamicharts/keycloak
# Docs: https://artifacthub.io/packages/helm/bitnami/keycloak
# Set enabled: false to use an external OIDC provider instead
# -----------------------------------------------------------------------------
keycloak:
  enabled: false
  auth:
    adminUser: admin
    adminPassword: ""          # MUST override — no default
  production: false
  proxyHeaders: xforwarded     # TLS terminated at ingress
  httpRelativePath: /
  postgresql:
    enabled: false             # Use the shared PostgreSQL instance
  externalDatabase:
    host: ""
    port: 5432
    database: keycloak
    user: keycloak
    password: ""
  ingress:
    enabled: false
    hostname: keycloak.example.com
    ingressClassName: nginx
    tls: false
    annotations: {}
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi
  # Realm import — the umbrella chart includes a post-install Job
  # (templates/keycloak-realm-import.yaml) that imports keycloak/owls-realm.json.
  # Set realmImport.enabled: false to skip automatic realm bootstrap.
  realmImport:
    enabled: true

# -----------------------------------------------------------------------------
# Zammad — Ticket engine backend for TicketOwl
# Chart: https://zammad.github.io/zammad-helm
# Set enabled: false if TicketOwl tenants bring their own Zammad instances
# -----------------------------------------------------------------------------
zammad:
  enabled: false
  # Zammad bundles its own Redis subchart. The top-level Bitnami Redis
  # helpers leak into Zammad's Redis context (Helm template name collision).
  # Provide the missing sentinel value to prevent nil-pointer errors.
  redis:
    sentinel:
      masterService:
        enabled: false

# -----------------------------------------------------------------------------
# MinIO (Bitnami) — S3-compatible object storage for BookOwl images
# Chart: oci://registry-1.docker.io/bitnamicharts/minio
# Set enabled: false to use AWS S3 or another external S3 provider instead
# -----------------------------------------------------------------------------
minio:
  enabled: false
  auth:
    rootUser: ""
    rootPassword: ""
  defaultBuckets: bookowl-images
  persistence:
    size: 10Gi

# -----------------------------------------------------------------------------
# Global overrides
# -----------------------------------------------------------------------------
nameOverride: ""
fullnameOverride: ""
