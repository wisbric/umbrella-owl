# =============================================================================
# umbrella-owl — Production overrides
# =============================================================================
# Layered on top of values.yaml:
#   helm install owl . -f values-production.yaml --set ...
#
# IMPORTANT: All secrets marked OVERRIDE below must be provided at install time
# via --set, external-secrets-operator, or sealed-secrets. Never commit real
# credentials to this file.
# =============================================================================

# -----------------------------------------------------------------------------
# NightOwl
# -----------------------------------------------------------------------------
nightowl:
  replicaCount:
    api: 3
    worker: 2

  image:
    tag: ""  # OVERRIDE — pin to release tag (e.g. v1.0.0)

  frontend:
    enabled: true
    image:
      tag: ""  # OVERRIDE — pin to release tag
    replicas: 2
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi

  api:
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: "1"
        memory: 512Mi

  worker:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  config:
    logLevel: info
    logFormat: json
    corsAllowedOrigins: "https://nightowl.example.com"

  secrets:
    databaseUrl: ""       # OVERRIDE
    redisUrl: ""          # OVERRIDE
    oidcIssuerUrl: ""     # OVERRIDE
    oidcClientId: ""      # OVERRIDE
    oidcClientSecret: ""  # OVERRIDE
    sessionSecret: ""     # OVERRIDE

  ingress:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: nightowl.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: nightowl-tls
        hosts:
          - nightowl.example.com

  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

# -----------------------------------------------------------------------------
# BookOwl
# -----------------------------------------------------------------------------
bookowl:
  image:
    tag: ""  # OVERRIDE

  web:
    image:
      tag: ""  # OVERRIDE
    replicas: 2
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi

  api:
    replicas: 3
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: "1"
        memory: 512Mi

  collab:
    replicas: 2
    image:
      tag: ""  # OVERRIDE
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: "1"
        memory: 512Mi
    wsUrl: ""   # OVERRIDE (e.g. wss://collab.bookowl.example.com)
    ingress:
      enabled: true
      host: ""  # OVERRIDE

  secretKey: ""  # OVERRIDE

  database:
    url: ""  # OVERRIDE

  redis:
    url: ""  # OVERRIDE
    host: ""
    port: "6379"

  oidc:
    issuerUrl: ""  # OVERRIDE
    clientId: bookowl

  nightowl:
    apiUrl: ""   # OVERRIDE (e.g. http://owl-nightowl:80)
    apiKey: ""   # OVERRIDE

  ingress:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/proxy-body-size: "20m"
    hosts:
      - host: bookowl.example.com
        paths:
          - path: /
            pathType: Prefix
            service: web
          - path: /api
            pathType: Prefix
            service: api
    tls:
      - secretName: bookowl-tls
        hosts:
          - bookowl.example.com

  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 30s

  pdb:
    enabled: true
    minAvailable: 1

# -----------------------------------------------------------------------------
# TicketOwl
# -----------------------------------------------------------------------------
ticketowl:
  image:
    tag: ""  # OVERRIDE

  api:
    replicaCount: 3
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: "1"
        memory: 512Mi
    autoscaling:
      enabled: true
      minReplicas: 3
      maxReplicas: 10
      targetCPUUtilizationPercentage: 75

  worker:
    replicaCount: 2
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  config:
    logLevel: info
    logFormat: json
    nightowlApiUrl: ""   # OVERRIDE
    bookowlApiUrl: ""    # OVERRIDE

  secrets:
    dbUrl: ""            # OVERRIDE
    redisUrl: ""         # OVERRIDE
    oidcIssuer: ""       # OVERRIDE
    oidcClientId: ""     # OVERRIDE
    encryptionKey: ""    # OVERRIDE
    nightowlApiKey: ""   # OVERRIDE
    bookowlApiKey: ""    # OVERRIDE

  ingress:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: ticketowl.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: ticketowl-tls
        hosts:
          - ticketowl.example.com

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

# -----------------------------------------------------------------------------
# PostgreSQL — disabled in production (use managed PostgreSQL)
# -----------------------------------------------------------------------------
postgresql:
  enabled: false

# -----------------------------------------------------------------------------
# Redis — disabled in production (use managed Redis)
# -----------------------------------------------------------------------------
redis:
  enabled: false

# -----------------------------------------------------------------------------
# Keycloak — enabled in production
# -----------------------------------------------------------------------------
keycloak:
  enabled: true
  auth:
    adminUser: admin
    adminPassword: ""  # OVERRIDE
  postgresql:
    enabled: false
  externalDatabase:
    host: ""     # OVERRIDE — point to managed PostgreSQL
    port: 5432
    database: keycloak
    user: keycloak
    password: ""  # OVERRIDE

# -----------------------------------------------------------------------------
# Zammad — enabled in production
# -----------------------------------------------------------------------------
zammad:
  enabled: true

# -----------------------------------------------------------------------------
# MinIO — disabled in production (use AWS S3 directly)
# -----------------------------------------------------------------------------
minio:
  enabled: false
